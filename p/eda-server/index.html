<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="前言 在老和山职业技术学院读书的时候就开始从事实验室的兼职网管，负责实验室的网络建设以及服务器的维护，也是时候写个文章把攒了这么多年的知识科普一下。\n"><title>Building EDA server from scratch</title>
<link rel=canonical href=https://churchmice.github.io/p/eda-server/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property='og:title' content="Building EDA server from scratch"><meta property='og:description' content="前言 在老和山职业技术学院读书的时候就开始从事实验室的兼职网管，负责实验室的网络建设以及服务器的维护，也是时候写个文章把攒了这么多年的知识科普一下。\n"><meta property='og:url' content='https://churchmice.github.io/p/eda-server/'><meta property='og:site_name' content='Free at last'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='linux'><meta property='article:published_time' content='2024-03-03T13:06:43+08:00'><meta property='article:modified_time' content='2024-03-03T13:06:43+08:00'><meta name=twitter:title content="Building EDA server from scratch"><meta name=twitter:description content="前言 在老和山职业技术学院读书的时候就开始从事实验室的兼职网管，负责实验室的网络建设以及服务器的维护，也是时候写个文章把攒了这么多年的知识科普一下。\n"><script async src="https://www.googletagmanager.com/gtag/js?id=G-KBJFX488RE"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-KBJFX488RE")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu4006794191083402183.png width=300 height=374 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🍥</span></figure><div class=site-meta><h1 class=site-name><a href=/>Free at last</a></h1><h2 class=site-description>You are who you choose to be !</h2></div></header><ol class=menu-social><li><a href=https://github.com/churchmice target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#硬件>硬件</a></li><li><a href=#网络配置>网络配置</a></li><li><a href=#系统安装>系统安装</a><ol><li><a href=#portal>portal</a></li><li><a href=#core>core</a></li><li><a href=#grid00>grid00</a></li><li><a href=#grid01>grid01</a></li><li><a href=#netapp>netapp</a></li></ol></li><li><a href=#软件安装及配置>软件安装及配置</a><ol><li><a href=#ssh-免密登录>ssh 免密登录</a></li><li><a href=#ntp>NTP</a></li><li><a href=#ipa>IPA</a><ol><li><a href=#server安装>server安装</a></li><li><a href=#client安装>client安装</a></li><li><a href=#ssl-证书>SSL 证书</a></li><li><a href=#常见操作>常见操作</a></li></ol></li><li><a href=#dns-解析>DNS 解析</a></li><li><a href=#netapp-1>netapp</a></li><li><a href=#gcc>gcc</a></li><li><a href=#sungrid>sungrid</a></li><li><a href=#gitlab>gitlab</a><ol><li><a href=#ssl>ssl</a></li><li><a href=#ldap>ldap</a></li><li><a href=#migration>migration</a></li></ol></li><li><a href=#jenkins>jenkins</a><ol><li><a href=#ssl-1>ssl</a></li><li><a href=#ldap-1>ldap</a></li></ol></li><li><a href=#etx>ETX</a><ol><li><a href=#server>server</a></li><li><a href=#node>node</a></li><li><a href=#ssl-2>ssl</a></li></ol></li><li><a href=#flexlm>flexlm</a></li><li><a href=#mirror>mirror</a></li></ol></li><li><a href=#安全设置>安全设置</a><ol><li><a href=#selinux>selinux</a></li><li><a href=#ssh限制>ssh限制</a></li><li><a href=#防火墙配置>防火墙配置</a></li><li><a href=#etx-配置>ETX 配置</a><ol><li><a href=#限制最大拷贝数>限制最大拷贝数</a></li><li><a href=#限制用户编辑profile>限制用户编辑profile</a></li></ol></li><li><a href=#邮件发送>邮件发送</a></li><li><a href=#目录夹权限>目录夹权限</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/work/>Work</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/eda-server/>Building EDA server from scratch</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 03, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 12 分钟</time></div></footer></div></header><section class=article-content><h1 id=前言>前言</h1><p>在<strong>老和山</strong>职业技术学院读书的时候就开始从事实验室的兼职网管，负责实验室的网络建设以及服务器的维护，也是时候写个文章把攒了这么多年的知识科普一下。</p><h2 id=硬件>硬件</h2><ul><li><strong>portal</strong>: 登录服务器，也是终端用户唯一可以访问的机器</li><li><strong>core</strong>: 核心服务器，上面部署了ipa,jenkins,gitlab,jira,sungrid等服务</li><li><strong>grid00</strong>: 运算服务器1，用作sungrid的computing node</li><li><strong>grid01</strong>: 运算服务器2，用作sungrid的computing node</li><li><strong>netapp</strong>: 存储服务器，做芯片的一般就用netapp</li></ul><h2 id=网络配置>网络配置</h2><p>参考的网络拓扑如下</p><ul><li>一个内网段 <strong>10.0.2.0/24</strong> (用于服务器之间的通信)</li><li>一个外网IP <strong>192.168.5.100</strong> 用于终端客户的访问</li><li>自定义域名: ic.X.com</li></ul><h2 id=系统安装>系统安装</h2><p>系统推荐用centos 7.9, 当然也可以用最新的centos 8 stream。在某些最新的server上面，硬件已经不支持centos 7了，所以只能装centos 8. 8和7的系统稍微在配置上稍微有一些差别。
安装的时候把一些开发者工具都给装上可以避免后续很多问题。</p><h3 id=portal>portal</h3><p>对外的网卡 ext: ip 配置成 192.168.5.100<br>对内的网卡 int: ip 配置成 10.0.2.1<br>配置网卡的时候一些注意事项</p><ul><li>NetworkManager的影响: 如果是直接修改 /etc/sysconfig/network-scripts的方式进行配置的话，记得里面加一行 <strong>NM_CONTROLLED=no</strong> ,或者干脆就把NetworkManger卸载掉得了</li><li>网卡的名字: 默认的名字总是奇奇怪怪，早起的叫ethX,后来变成emX,如果是光口，名字可能叫做p1p2这种，这种名字可以在ifcfg-<em>xx</em> 里面进行修改
可以使用以下命令对网卡名字做动态修改</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ip link set old_device_name name new_device_name
</span></span></code></pre></td></tr></table></div></div><p>如果是要静态修改的话需要对ifcfg-xx做以下修改</p><ul><li>将ifcfg_old_name重命名为ifcfg_new_name</li><li>将文件里面的DEVICE和NAME修改为new_name</li><li>HWADDR需要修改成网卡的真实地址</li></ul><h3 id=core>core</h3><p>网卡 int: ip 配置成10.0.2.100
额外注意事项</p><ul><li>该机器最后会当做flexlm的license server,有些license daemon是挑网卡名字的，比如TSMC的一定要求网卡的名字是<strong>eth</strong> 打头，所以请至少保留一块网卡地址用这个名字</li><li>如果有改MAC地址需求的，需要再ifcfg-<em>xx</em> 里面需要用<strong>HWADDR</strong>指定网卡之前的MAC地址，让后用<strong>MACADDR</strong>指明需要更改的MAC地址</li></ul><h3 id=grid00>grid00</h3><p>网卡 int: ip 配置成 10.0.2.10</p><h3 id=grid01>grid01</h3><p>网卡 int: ip 配置成 10.0.2.12</p><h3 id=netapp>netapp</h3><p>取决于买的型号类型，一般需要配置业务口和管理口，后者仅用于管理功能，带宽需求不大。业务口的话推荐做链路聚合。</p><h2 id=软件安装及配置>软件安装及配置</h2><h3 id=ssh-免密登录>ssh 免密登录</h3><p>首先产生密钥对</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ssh-keygen -t ed25519
</span></span></code></pre></td></tr></table></div></div><p>不用RSA的原因是RSA的密钥长，计算工作量大，而且安全性也不高。题外话，RSA512现在已经可以用普通计算机进行暴力破解了。
然后将公钥复制黏贴进对方机器的 <strong>.ssh/authorized_keys</strong> 即可，当然你也可以用以下命令进行自动拷贝</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ssh-copy-id -i eda25519.pub core
</span></span></code></pre></td></tr></table></div></div><h3 id=ntp>NTP</h3><p>使用chrony
portal作为NTP server,提供定时服务给到10.0.2.0/24网段</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@portal:~ <span class=c1>#-&gt; cat /etc/chrony.conf |grep -v &#39;^#&#39;</span>
</span></span><span class=line><span class=cl>erver 0.centos.pool.ntp.org iburst
</span></span><span class=line><span class=cl>server 1.centos.pool.ntp.org iburst
</span></span><span class=line><span class=cl>server 2.centos.pool.ntp.org iburst
</span></span><span class=line><span class=cl>server 3.centos.pool.ntp.org iburst
</span></span><span class=line><span class=cl>driftfile /var/lib/chrony/drift
</span></span><span class=line><span class=cl>makestep 1.0 <span class=m>3</span>
</span></span><span class=line><span class=cl>rtcsync
</span></span><span class=line><span class=cl>allow 10.0.2.0/24
</span></span><span class=line><span class=cl><span class=nb>local</span> stratum <span class=m>10</span>
</span></span><span class=line><span class=cl>logdir /var/log/chrony
</span></span><span class=line><span class=cl>log measurements statistics tracking
</span></span></code></pre></td></tr></table></div></div><p>其他服务器需要将upstream设置为portal</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>root@grid00:~ <span class=c1>#-&gt;cat /etc/chrony.conf|grep -v &#39;^#&#39;</span>
</span></span><span class=line><span class=cl>server 10.0.2.1 iburst
</span></span><span class=line><span class=cl>driftfile /var/lib/chrony/drift
</span></span><span class=line><span class=cl>makestep 1.0 <span class=m>3</span>
</span></span><span class=line><span class=cl>rtcsync
</span></span><span class=line><span class=cl>logdir /var/log/chrony
</span></span></code></pre></td></tr></table></div></div><h3 id=ipa>IPA</h3><p>这个是一个认证服务器，大家可能听说过nis,nisplus,yellowpage,ldap其实本质都是一个东西，只不过扩展性不一样。IPA的话其实底层走的还是ldap那一套,只不过集成了管理界面，对用户更加友好。</p><h4 id=server安装>server安装</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ipa-server-install -N --domain-level <span class=m>0</span> --allow-zone-overlap --idstart <span class=m>2000</span>
</span></span></code></pre></td></tr></table></div></div><p>注意其中的<code>idstart</code> ，根据情况自己修改
安装过程中会提示admin password和directory manager的password
安装过程会提示上游DNS,填10.0.2.1</p><h4 id=client安装>client安装</h4><p>以grid00为例</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ipa-client-install --server<span class=o>=</span>core.ic.X.com --domain<span class=o>=</span>grid00.ic.X.com -N --enable-dns-updates --hostname<span class=o>=</span>grid00.ic.X.com
</span></span></code></pre></td></tr></table></div></div><h4 id=ssl-证书>SSL 证书</h4><p>在IPA server的安装过程中，会将产生的root CA放在/root/cacert.p12下面，可以用
<a href=https://hohnstaedt.de/xca/ target=_blank>xca</a>
导入进行管理，以后可以用这个root CA签名新的证书。导入过程中会提示你输入密码，这个密码就是安装过程中输入的admin password。
都已经2024年了，推荐所有的服务都上https</p><p>IPA的管理界面默认会占用80/443/8080/8443端口，请避免和其他服务冲突
windows电脑登录的时候会跳出一个认证框，这是因为windows支持kerbose login, 可以通过在 /etc/httpd/conf.d/ipa.conf 里面添加如下配置禁用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-apacheconf data-lang=apacheconf><span class=line><span class=cl><span class=nb>GssapiSessionKey</span> file:/etc/httpd/alias/ipasession.key
</span></span><span class=line><span class=cl><span class=nb>BrowserMatch</span> Windows gssapi-no-negotiate
</span></span></code></pre></td></tr></table></div></div><h4 id=常见操作>常见操作</h4><h5 id=增加一个dns解析>增加一个DNS解析</h5><p>如果你只是想增加一个DNS解析的话，可以使用下面的命令（将gitlab.ic.X.com解析成10.0.2.100）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ipa dnsrecord-add ic.X.com. --name gitlab --a-rec 10.0.2.100
</span></span></code></pre></td></tr></table></div></div><h5 id=缓存刷新>缓存刷新</h5><p>刷新IPA缓存</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sss_cache -E
</span></span></code></pre></td></tr></table></div></div><p>刷新系统缓存</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>systemctl restart sssd
</span></span></code></pre></td></tr></table></div></div><h3 id=dns-解析>DNS 解析</h3><p>在portal上面安装dnsmasq并指定上游，例如 114
修改所有机器的 /etc/resolv.conf</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>search ic.X.com
</span></span><span class=line><span class=cl>nameserver 10.0.2.100
</span></span></code></pre></td></tr></table></div></div><p>这里再次吐槽NetworkManager,默认是会去把这个文件给overwrite掉的，需要做一些额外处理。或者就像我一样，不管三七二十一，直接把NetworkManager给干了。
一个典型的查询场景如下所示，需要注意的是如果查询的域名位于ic.X.com，那直接在core就会返回查询结果。</p><pre class=mermaid>sequenceDiagram
  participant grid00
  participant core
  participant portal
  participant public_dns
  grid00 ->> core: DNS query for www.baidu.com
  core ->> portal: forward the query
  portal ->> public_dns: forward the query
  public_dns ->> portal: query result for www.baidu.com
  portal ->> core: query result for www.baidu.com
  core ->> grid00: query result for www.baidu.com
</pre><h3 id=netapp-1>netapp</h3><p>将netapp的目录以NFS的方式挂载到各台机器上，建议挂载分区如下</p><ul><li>/proj: 项目相关的文件</li><li>/tools: EDA工具</li><li>/tmpdir: 临时目录，比如仿真文件等</li><li>/home: 用户主目录</li><li>/opt/sge: sungrid的共享目录，其实严格意义上来说只有SGE_CELL那个路径才需要共享，但是都共享了也没太大问题。直接用core分享也可以
需要注意的是netapp默认的nfs4版本会进行root_squash,导致root账号被映射成了nobody,解决办法是在挂载的时候选择用nfs3挂载</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-apacheconf data-lang=apacheconf><span class=line><span class=cl><span class=err>10</span>.<span class=err>0</span>.<span class=err>2</span>.<span class=err>155:/</span><span class=nb>home</span>                        <span class=sx>/home</span>		        nfs 	defaults,async,nosuid,nodev,hard,intr,nfsvers=3,timeo=60,retrans=5 	<span class=m>0</span> <span class=m>0</span>
</span></span></code></pre></td></tr></table></div></div><p>netapp如果要关系，需要使用以下命令,要防止主node被backup node给take over掉</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>system node halt -node * -skip-lif-migration-before-shutdown <span class=nb>true</span> -ignore-quorum-warnings <span class=nb>true</span> -inhibit-takeover <span class=nb>true</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=gcc>gcc</h3><p>系统如果要安装多个gcc版本，建议下载源码解压之后用如下方式进行编译</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>./contrib/download_prerequisites
</span></span><span class=line><span class=cl>mkdir build <span class=o>&amp;&amp;</span> <span class=nb>cd</span> build
</span></span><span class=line><span class=cl>../configure --prefix<span class=o>=</span>/tools/misc/gcc/xx.xx.xx --enable-checking<span class=o>=</span>release --enable-languages<span class=o>=</span>c,c++ --enable-threads<span class=o>=</span>posix --disable-multilib --with-system-zlib 
</span></span><span class=line><span class=cl>make -j64 <span class=o>&amp;&amp;</span> make install
</span></span></code></pre></td></tr></table></div></div><p>版本之间的切换可以用
<a href=https://modules.readthedocs.io/en/latest/ target=_blank>modules</a>
进行管理。</p><h3 id=sungrid>sungrid</h3><p>sungrid是一个开源的集群运算软件，在core上执行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yum install -y jemalloc gridengine gridengine-execd gridengine-guiinst gridengine-qmaster gridengine-qmon
</span></span></code></pre></td></tr></table></div></div><p>然后通过如下命令启动图形安装界面</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> /opt/sge <span class=o>&amp;&amp;</span> ./start_gui_installer
</span></span></code></pre></td></tr></table></div></div><h3 id=gitlab>gitlab</h3><p><a href=https://about.gitlab.com/ target=_blank>gitlab</a>
是一个可以私有部署的程序员内部交友网站，主要的配置文件是/etc/gitlab/gitlab.rb。
最重要的数据文件推荐放在netapp的存储上面，备份文件建议放在core的本地存储上面，对应的配置如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl> <span class=n>git_data_dirs</span><span class=p>({</span>
</span></span><span class=line><span class=cl>   <span class=s2>&#34;default&#34;</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=s2>&#34;path&#34;</span> <span class=o>=&gt;</span> <span class=s2>&#34;/proj/git&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>gitlab_rails</span><span class=o>[</span><span class=s1>&#39;manage_backup_path&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=kp>true</span>
</span></span><span class=line><span class=cl><span class=n>gitlab_rails</span><span class=o>[</span><span class=s1>&#39;backup_path&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=s2>&#34;/data/backup/gitlab&#34;</span>
</span></span><span class=line><span class=cl><span class=n>gitlab_rails</span><span class=o>[</span><span class=s1>&#39;backup_gitaly_backup_path&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=s2>&#34;/opt/gitlab/embedded/bin/gitaly-backup&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=n>gitlab_rails</span><span class=o>[</span><span class=s1>&#39;backup_keep_time&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=mi>2592000</span>
</span></span></code></pre></td></tr></table></div></div><p>对gitlab.rb的内容进行更改之后，需要通过如下命令进行配置刷新</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>gitlab-ctl reconfigure
</span></span></code></pre></td></tr></table></div></div><h4 id=ssl>ssl</h4><p>要将CA放到 <strong>/etc/gitlab/trusted-certs</strong> 下面
修改gitlab.rb,关键配置如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>nginx</span><span class=o>[</span><span class=s1>&#39;ssl_certificate&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=s2>&#34;/etc/ssl/ic.X.com/server.crt&#34;</span>
</span></span><span class=line><span class=cl><span class=n>nginx</span><span class=o>[</span><span class=s1>&#39;ssl_certificate_key&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=s2>&#34;/etc/ssl/ic.X.com/server.key&#34;</span>
</span></span><span class=line><span class=cl><span class=n>external_url</span> <span class=s1>&#39;https://core.ic.X.com&#39;</span>
</span></span><span class=line><span class=cl><span class=n>nginx</span><span class=o>[</span><span class=s1>&#39;listen_port&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=mi>1024</span>
</span></span></code></pre></td></tr></table></div></div><p>可以通过下面的rewrite rule将
<a href=https://git.ic.X.com target=_blank>https://git.ic.X.com</a>
重定向到
<a href=https://core.ic.X.com:1024 target=_blank>https://core.ic.X.com:1024</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-apacheconf data-lang=apacheconf><span class=line><span class=cl><span class=err>root@core:~</span> <span class=c>#-&gt; cat /etc/httpd/conf.d/gitlab-rewrite.conf</span>
</span></span><span class=line><span class=cl><span class=c># VERSION 6 - DO NOT REMOVE THIS LINE</span>
</span></span><span class=line><span class=cl><span class=nb>RewriteEngine</span> <span class=k>on</span>
</span></span><span class=line><span class=cl><span class=nb>RewriteRule</span> ^/gitlab        https://core.ic.X.com:1024 [L,R=301]
</span></span></code></pre></td></tr></table></div></div><h4 id=ldap>ldap</h4><p>修改gitlab.rb.关键配置如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl> <span class=n>gitlab_rails</span><span class=o>[</span><span class=s1>&#39;ldap_enabled&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=kp>true</span>
</span></span><span class=line><span class=cl> <span class=n>gitlab_rails</span><span class=o>[</span><span class=s1>&#39;prevent_ldap_sign_in&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=kp>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=n>gitlab_rails</span><span class=o>[</span><span class=s1>&#39;ldap_servers&#39;</span><span class=o>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=s1>&#39;main&#39;</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;label&#39;</span> <span class=o>=&gt;</span>  <span class=s1>&#39;LDAP&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;host&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;core.ic.X.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;port&#39;</span> <span class=o>=&gt;</span>  <span class=mi>636</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;uid&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;uid&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;bind_dn&#39;</span> <span class=o>=&gt;</span>  <span class=s1>&#39;uid=dummy,cn=users,cn=accounts,dc=ic,dc=X,dc=com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;base&#39;</span>  <span class=o>=&gt;</span> <span class=s1>&#39;dc=ic,dc=X,dc=com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;password&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;password for dummy&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;encryption&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;simple_tls&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;verify_certificates&#39;</span> <span class=o>=&gt;</span> <span class=kp>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;smartcard_auth&#39;</span> <span class=o>=&gt;</span> <span class=kp>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;active_directory&#39;</span> <span class=o>=&gt;</span> <span class=kp>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;allow_username_or_email_login&#39;</span> <span class=o>=&gt;</span> <span class=kp>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;lowercase_usernames&#39;</span> <span class=o>=&gt;</span> <span class=kp>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;block_auto_created_users&#39;</span> <span class=o>=&gt;</span> <span class=kp>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;user_filter&#39;</span> <span class=o>=&gt;</span>  <span class=s1>&#39;memberOf=cn=staff,cn=groups,cn=accounts,dc=ic,dc=X,dc=com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;attributes&#39;</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;username&#39;</span> <span class=o>=&gt;</span> <span class=o>[</span><span class=s1>&#39;uid&#39;</span><span class=o>]</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;email&#39;</span> <span class=o>=&gt;</span> <span class=o>[</span><span class=s1>&#39;Email&#39;</span><span class=o>]</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;name&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;cn&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;first_name&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;givenName&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;last_name&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;sn&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>     <span class=c1>## EE only</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;group_base&#39;</span> <span class=o>=&gt;</span>  <span class=s1>&#39;cn=groups,cn=accounts,dc=ic,dc=X,dc=com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;admin_group&#39;</span> <span class=o>=&gt;</span>  <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;sync_ssh_keys&#39;</span> <span class=o>=&gt;</span>  <span class=kp>false</span>
</span></span><span class=line><span class=cl>   <span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>配置完之后可以用如下命令进行测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>gitlab-rake gitlab:ladap:check
</span></span></code></pre></td></tr></table></div></div><h4 id=migration>migration</h4><p>可以用如下的方式进行迁移</p><ol><li>进入旧文件夹，git remote 解除远端reposity的绑定</li><li>git remote 添加新远端repository</li><li>git push</li></ol><h3 id=jenkins>jenkins</h3><h4 id=ssl-1>ssl</h4><p>jenkins用的是java那一套，所以ssl的支持稍微麻烦一点。
CA: <strong>update-ca-trust</strong> 本身就已经产生了java需要的CA,具体的路径是 <strong>/etc/pki/ca-trust/extracted/java/cacerts</strong>
https证书: 用xca生成p12格式的证书(.pfx),然后用如下命令转换,其中changeit是证书导出的时候设置的密码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>keytool -importkeystore -srcstorepass changeit -deststorepass changeit -srckeystore ssl.pfx -srcstoretype pkcs12 -destkeystore jenkins.jks -deststoretype JKS
</span></span></code></pre></td></tr></table></div></div><p>修改配置文件 <strong>/usr/lib/systemd/system/jenkins.service</strong>，关键配置如下:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-apacheconf data-lang=apacheconf><span class=line><span class=cl><span class=err>root@core:~</span> <span class=c>#-&gt; cat /usr/lib/systemd/system/jenkins.service|grep -v &#39;^#&#39;</span>
</span></span><span class=line><span class=cl><span class=c>#jenkins is picky on java version, must use version 17</span>
</span></span><span class=line><span class=cl><span class=err>Environment=&#34;JAVA_HOME=/usr/java/jdk-17</span>.<span class=err>0</span>.<span class=err>5&#34;</span>
</span></span><span class=line><span class=cl><span class=err>Environment=&#34;JENKINS_JAVA_CMD=/usr/java/jdk-17</span>.<span class=err>0</span>.<span class=err>5/bin/java&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>#load the CA so we can use ldaps </span>
</span></span><span class=line><span class=cl><span class=err>Environment=&#34;JAVA_OPTS=-Djava</span>.<span class=err>awt</span>.<span class=err>headless=</span><span class=nb>true</span> -Djavax.net.ssl.trustStore=/home/jenkins/config/cacerts -Djavax.net.ssl.trustStorePassword=changeit<span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>#turn off http and enable https
</span></span></span><span class=line><span class=cl><span class=s2>Environment=&#34;</span>JENKINS_PORT=-1<span class=s2>&#34; 
</span></span></span><span class=line><span class=cl><span class=s2>Environment=&#34;</span>JENKINS_HTTPS_LISTEN_ADDRESS=10.0.2.100<span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>Environment=&#34;</span>JENKINS_HTTPS_PORT=8888<span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>#specify the https ceritificate
</span></span></span><span class=line><span class=cl><span class=s2>Environment=&#34;</span>JENKINS_HTTPS_KEYSTORE=/home/jenkins/config/jenkins.jks<span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>Environment=&#34;</span>JENKINS_HTTPS_KEYSTORE_PASSWORD=changeit<span class=err>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>[Install]</span>
</span></span><span class=line><span class=cl><span class=err>WantedBy=multi-user</span>.<span class=nb>target</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=ldap-1>ldap</h4><p>需要安装ldap插件，<strong>/home/jenkins/config.xml</strong> 里面的关键配置信息如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;securityRealm</span> <span class=na>class=</span><span class=s>&#34;hudson.security.LDAPSecurityRealm&#34;</span> <span class=na>plugin=</span><span class=s>&#34;ldap@682.v7b_544c9d1512&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;disableMailAddressResolver&gt;</span>false<span class=nt>&lt;/disableMailAddressResolver&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;configurations&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;jenkins.security.plugins.ldap.LDAPConfiguration&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;server&gt;</span>ldaps://core.ic.X.com<span class=nt>&lt;/server&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;rootDN&gt;</span>dc=ic,dc=X,dc=com<span class=nt>&lt;/rootDN&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;inhibitInferRootDN&gt;</span>false<span class=nt>&lt;/inhibitInferRootDN&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;userSearchBase&gt;</span>cn=users,cn=accounts<span class=nt>&lt;/userSearchBase&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;userSearch&gt;</span>uid={0}<span class=nt>&lt;/userSearch&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;groupMembershipStrategy</span> <span class=na>class=</span><span class=s>&#34;jenkins.security.plugins.ldap.FromGroupSearchLDAPGroupMembershipStrategy&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;filter&gt;&lt;/filter&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/groupMembershipStrategy&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;managerDN&gt;</span>uid=dummy,cn=users,cn=accounts,dc=ic,dc=X,dc=com<span class=nt>&lt;/managerDN&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;managerPasswordSecret&gt;</span>{dummy_password_hash}<span class=nt>&lt;/managerPasswordSecret&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;displayNameAttributeName&gt;</span>displayname<span class=nt>&lt;/displayNameAttributeName&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;mailAddressAttributeName&gt;</span>mail<span class=nt>&lt;/mailAddressAttributeName&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;ignoreIfUnavailable&gt;</span>false<span class=nt>&lt;/ignoreIfUnavailable&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/jenkins.security.plugins.ldap.LDAPConfiguration&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/configurations&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;userIdStrategy</span> <span class=na>class=</span><span class=s>&#34;jenkins.model.IdStrategy$CaseInsensitive&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupIdStrategy</span> <span class=na>class=</span><span class=s>&#34;jenkins.model.IdStrategy$CaseInsensitive&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;disableRolePrefixing&gt;</span>true<span class=nt>&lt;/disableRolePrefixing&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/securityRealm&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>如果因为某些原因导致更改完了登录不了jenkins ( 比如权限忘记配置了)，只需要将下面的配置从true改为false即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>  <span class=nt>&lt;useSecurity&gt;</span>true<span class=nt>&lt;/useSecurity&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=etx>ETX</h3><p>这是一个服务器登录软件。推荐
<a href=https://www.opentext.nl/products-and-solutions/products/specialty-technologies/connectivity/exceed-ondemand target=_blank>EXT</a>
，吊打一切牛鬼蛇神，主要优势有以下几个</p><ul><li>只用开放一个端口即可，这样就方便进行管理。vnc这种每个用户都开一个端口的方式一是不方便管理，而是有漏洞，用户要进行脱库操作很容易。</li><li>可以对上传下载权限进行单独管理，一般只允许上传，不允许下载</li><li>可以限制从服务器到本地复制黏贴的字符个数，有效的防止了用户通过<strong>CTRL+C</strong> <strong>CTRL+V</strong> 的方式拷贝代码到本地</li><li>集成ldap认证，可对用户登录以及可见的profile做限制
当然他的缺点也是显而易见的，那就是需要花钱购买。这公司的销售人员也是非常了解国情，默认都是提供买断的license服务，一次购买，终身可用，然后单个license的价格还是不便宜。</li></ul><h4 id=server>server</h4><p>建议安装在core上面，然后通过端口映射的方式映射到portal的8443端口</p><h4 id=node>node</h4><p>建议安装在portal上面，默认端口是5510
添加node的时候选择10.0.2.1,端口5510,然后再client IP里面进行重映射，比如192.168.5.100:5510</p><h4 id=ssl-2>ssl</h4><p>如果要增加ssl支持，需要修改 <strong>$INSTALL_DIR/data/ssl</strong> 里面的 <strong>server.key</strong> 和<strong>server.crt</strong>. 可以用前文提到的xca工具生成，懒人的话建议生成通配符证书即可。
另外其实在linux上面做ETX的多开很容易，文件夹复制黏贴改个名字就行了。Windows node 复制黏贴比较麻烦，暂时还没有花精力去搞。至于为何要多开？那当然是解决license个数不足的问题了。</p><h3 id=flexlm>flexlm</h3><p>几乎所有的eda工具都是用flexlm来管理的，这个和谐方式也是各式各样。有一些注意事项</p><ol><li>允许在同一个端口上起多个vendor的license daemon,比如你可以把不同家的license文件里面的端口都改成一样的，然后lmgrd一起启动</li><li>一些和谐版的license daemon会有相互打架的情况，所以1的前提就不成立了</li><li>有些vendor daemon对网卡名字有特别要求，一定要求是 <em>eth</em> 开头，比如TSMC</li><li>license文件可以进行复制操作，比如你只买了10个正版license，如何扩展成100个，土鳖一点的方法就是用虚拟机多开，修改MAC地址。但是其实不用这么麻烦的，你在一台机器上也有办法实现开N个相同的vendor daemon的。
由于可能不是那么众所周知的原因，宝岛台湾的一些工具是不使用flexlm管理的。个人推测一方面是成本考虑，另一方面是因为他们知道flexlm的license很容易被和谐，又不像大厂可以承受被破解的代价，所以就自己开发了一套软件授权管理工具。</li></ol><h3 id=mirror>mirror</h3><p>在core上面设置centos的mirror,portal通过rsync的方式将外部的mirror同步到core上
一个简单的用perl写的同步脚本如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-perl data-lang=perl><span class=line><span class=cl><span class=ch>#!/usr/bin/perl</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>strict</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nn>warnings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$lock_file</span> <span class=o>=</span> <span class=s>&#34;/run/lock/subsys/repo_rsync&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>exit</span> <span class=k>if</span> <span class=o>-</span><span class=n>e</span> <span class=nv>$lock_file</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Set the PATH</span>
</span></span><span class=line><span class=cl><span class=nv>$ENV</span><span class=p>{</span><span class=s>&#39;PATH&#39;</span><span class=p>}</span> <span class=o>=</span> <span class=s>&#34;/bin:/usr/bin:/sbin&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>system</span><span class=p>(</span><span class=s>&#34;touch $lock_file&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$base_path</span> <span class=o>=</span> <span class=s>&#34;/repo/centos&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>$version</span>   <span class=o>=</span> <span class=s>&#34;7.9.2009&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>my</span> <span class=nv>@parts</span>     <span class=o>=</span> <span class=sx>qw ( </span><span class=n>centosplus</span> <span class=n>os</span> <span class=n>updates</span> <span class=n>extras</span> <span class=n>contrib</span> <span class=n>epel</span> <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>#my @parts     = qw ( epel );</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Invoke the rsync to update the repo</span>
</span></span><span class=line><span class=cl><span class=c1>#For rpmforge, use this one rsync://ftp-stud.fht-esslingen.de/dag</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>@parts</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>next</span> <span class=k>if</span> <span class=nv>$_</span> <span class=ow>eq</span> <span class=s>&#39;contrib&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span> <span class=nv>$_</span> <span class=ow>eq</span> <span class=s>&#39;epel&#39;</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>system</span><span class=p>(</span> <span class=s>&#34;rsync -avSHP --exclude &#39;debug&#39; --exclude &#39;repodata&#39; --exclude &#39;repoview&#39; --delete --delete-excluded rsync://mirror.sjtu.edu.cn/fedora/epel/7/x86_64/ $base_path/$version/$_/x86_64/Packages/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>#system( &#34;rsync -avSHP --delete rsync.mirrors.ustc.edu.cn::repo/centos/$version/$_/x86_64/Packages/ $base_path/$version/$_/x86_64/Packages/&#34;);</span>
</span></span><span class=line><span class=cl>        <span class=c1>#update: need to remove the repo prefix</span>
</span></span><span class=line><span class=cl>        <span class=nb>system</span><span class=p>(</span> <span class=s>&#34;rsync -avSHP --delete rsync.mirrors.ustc.edu.cn::centos/$version/$_/x86_64/Packages/ $base_path/$version/$_/x86_64/Packages/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Invoke createrepo</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>@parts</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>system</span><span class=p>(</span><span class=s>&#34;ssh core createrepo --workers 16 $base_path/$version/$_/x86_64&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>unlink</span> <span class=nv>$lock_file</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>在core上面讲mirror通过https的形式提供给其他人，具体的方法如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-apacheconf data-lang=apacheconf><span class=line><span class=cl><span class=err>root@core:</span> <span class=c>#-&gt; cat /etc/httpd/conf.d/repo.conf</span>
</span></span><span class=line><span class=cl><span class=nb>Alias</span> <span class=sx>/centos</span> <span class=s2>&#34;/repo/centos&#34;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;Directory</span>  <span class=s>/repo/centos</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nb>Options</span> Indexes FollowSymLinks MultiViews
</span></span><span class=line><span class=cl>    <span class=nb>AllowOverride</span> <span class=k>all</span>
</span></span><span class=line><span class=cl>    <span class=nb>Require</span> <span class=k>all</span> granted
</span></span><span class=line><span class=cl><span class=nt>&lt;/Directory&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>最后修改机器的更新源为core</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-apacheconf data-lang=apacheconf><span class=line><span class=cl><span class=err>root@core:</span> <span class=c>#-&gt; cat /etc/yum.repos.d/local.repo</span>
</span></span><span class=line><span class=cl><span class=err>[local-base]</span>
</span></span><span class=line><span class=cl><span class=err>name=local-$</span><span class=nb>releasever</span> - Base
</span></span><span class=line><span class=cl><span class=err>baseurl=https://core</span>.<span class=err>ic</span>.<span class=err>X</span>.<span class=err>com/centos/$releasever/os/$basearch/</span>
</span></span><span class=line><span class=cl><span class=err>gpgkey=https://core</span>.<span class=err>ic</span>.<span class=err>X</span>.<span class=err>com/centos/$releasever/RPM-GPG-CentOS-7</span>
</span></span><span class=line><span class=cl><span class=err>gpgcheck=1</span>
</span></span><span class=line><span class=cl><span class=err>enabled=1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>[local-updates]</span>
</span></span><span class=line><span class=cl><span class=err>name=local-$</span><span class=nb>releasever</span> - Updates
</span></span><span class=line><span class=cl><span class=err>baseurl=https://core</span>.<span class=err>ic</span>.<span class=err>X</span>.<span class=err>com/centos/$releasever/updates/$basearch/</span>
</span></span><span class=line><span class=cl><span class=err>gpgkey=https://core</span>.<span class=err>ic</span>.<span class=err>X</span>.<span class=err>com/centos/$releasever/RPM-GPG-CentOS-7</span>
</span></span><span class=line><span class=cl><span class=err>gpgcheck=1</span>
</span></span><span class=line><span class=cl><span class=err>enabled=1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>[local-extras]</span>
</span></span><span class=line><span class=cl><span class=err>name=local-$</span><span class=nb>releasever</span> - Extras
</span></span><span class=line><span class=cl><span class=err>baseurl=https://core</span>.<span class=err>ic</span>.<span class=err>X</span>.<span class=err>com/centos/$releasever/extras/$basearch/</span>
</span></span><span class=line><span class=cl><span class=err>gpgkey=https://core</span>.<span class=err>ic</span>.<span class=err>X</span>.<span class=err>com/centos/$releasever/RPM-GPG-CentOS-7</span>
</span></span><span class=line><span class=cl><span class=err>gpgcheck=1</span>
</span></span><span class=line><span class=cl><span class=err>enabled=1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>[local-centosplus]</span>
</span></span><span class=line><span class=cl><span class=err>name=local-$</span><span class=nb>releasever</span> - Plus
</span></span><span class=line><span class=cl><span class=err>baseurl=https://core</span>.<span class=err>ic</span>.<span class=err>X</span>.<span class=err>com/centos/$releasever/centosplus/$basearch/</span>
</span></span><span class=line><span class=cl><span class=err>gpgkey=https://core</span>.<span class=err>ic</span>.<span class=err>X</span>.<span class=err>com/centos/$releasever/RPM-GPG-CentOS-7</span>
</span></span><span class=line><span class=cl><span class=err>gpgcheck=1</span>
</span></span><span class=line><span class=cl><span class=err>enabled=1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>[local-contrib]</span>
</span></span><span class=line><span class=cl><span class=err>name=local-$</span><span class=nb>releasever</span> - Contrib
</span></span><span class=line><span class=cl><span class=err>baseurl=https://core</span>.<span class=err>ic</span>.<span class=err>X</span>.<span class=err>com/centos/$releasever/contrib/$basearch/</span>
</span></span><span class=line><span class=cl><span class=err>gpgcheck=0</span>
</span></span><span class=line><span class=cl><span class=err>enabled=1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>[local-epel]</span>
</span></span><span class=line><span class=cl><span class=err>name=local-$</span><span class=nb>releasever</span> - Epel
</span></span><span class=line><span class=cl><span class=err>baseurl=https://core</span>.<span class=err>ic</span>.<span class=err>X</span>.<span class=err>com/centos/$releasever/epel/$basearch/</span>
</span></span><span class=line><span class=cl><span class=err>gpgcheck=0</span>
</span></span><span class=line><span class=cl><span class=err>enabled=1</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=安全设置>安全设置</h2><h3 id=selinux>selinux</h3><p>这个东西很好，但是也很麻烦，如果不是很会折腾，建议关闭:</p><blockquote><p>编辑 /etc/sysconfig/selinux, 将里面的SELINUX更改成disabled，然后重启</p></blockquote><h3 id=ssh限制>ssh限制</h3><p>需要在/etc/ssh/sshd_config里面做如下配置</p><ul><li>普通用户关闭ssh登录权限</li><li>打开core上的git登录权限，这是为了使用ssh进行git的checkout</li><li>只允许基于ssh key的登录方式，这是为了防止MTIM攻击</li></ul><h3 id=防火墙配置>防火墙配置</h3><p>内网的机器可以把防火墙都关掉<br>portal上面的防火墙只开放必要的端口，INPUT/OUTPUT/FORWARD的policy都设置成DROP<br>portal作为登录机器是不允许跑EDA软件的，所以在core的防火墙上面要阻止来自portal的license请求<br>另外需要注意虚拟机的网络是不受iptables控制的，所以在portal上绝对绝对不要装虚拟机软件，不让网络无法管控</p><h3 id=etx-配置>ETX 配置</h3><h4 id=限制最大拷贝数>限制最大拷贝数</h4><p>profile -> general -> optional settings 里面添加如下配置（最大只允许拷贝512个字符)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-apacheconf data-lang=apacheconf><span class=line><span class=cl><span class=err>proxy</span>.<span class=err>AllowCopyFromX=512</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=限制用户编辑profile>限制用户编辑profile</h4><p>如果允许用户自己编辑profile,他就可以设置一个profile允许上传和下载，这无疑是有问题的</p><h3 id=邮件发送>邮件发送</h3><p>jenkins/gitlab等都有发送邮件的需求，但是core本身是无法连接外网的，解决方法就是要借助core
需要有一个专门的邮件账号用来发邮件（<em>jarvis</em>)，这个账号只能开放smtp功能，不能开放 imap功能，这主要是为了防止有用户发完邮件又通过imap将发送邮件删除，从而销毁证据<br>具体步骤如下</p><ol><li>在portal上面开一个邮件代理，只允许特定IP连接本地的465端口</li><li>在core上，只有特定用户才可以连接到core的465端口,包括以下用户<ol><li>ETX 服务: root</li><li>jenkins服务: jenkins</li></ol></li><li>上面两个步骤是确保用户无法使用自己的邮箱发送邮件，而只能通过jarvis账号发送</li><li>jarvis账号会将所有内容存档，便于安全审计
邮件代理可以用nginx处理,关键配置如下</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-apacheconf data-lang=apacheconf><span class=line><span class=cl><span class=err>root@portal0:~</span> <span class=c>#-&gt; cat /etc/nginx/stream/mail_pro.conf</span>
</span></span><span class=line><span class=cl><span class=nb>upstream</span> mailsmtp_pro {
</span></span><span class=line><span class=cl>       <span class=nb>server</span> smtp.qiye.aliyun.com:465;
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>server</span> {
</span></span><span class=line><span class=cl>       <span class=nb>listen</span> <span class=m>465</span>;
</span></span><span class=line><span class=cl>       <span class=nb>proxy_connect_timeout</span> <span class=m>5</span>s;
</span></span><span class=line><span class=cl>       <span class=nb>proxy_timeout</span> <span class=m>5</span>s;
</span></span><span class=line><span class=cl>       <span class=nb>proxy_pass</span> mailsmtp_pro;
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=目录夹权限>目录夹权限</h3><p>下面这些文件夹需要设置合适的权限保证普通用户无法看到</p><ul><li>/proj/git: 里面存放了git的database</li><li>/proj/xxx: 只有处于项目组xxx里面的人才能进入</li><li>/data/backup: 需要保证普通用户无法访问备份文件夹</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/linux/>Linux</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/fpga-bot/><div class=article-details><h2 class=article-title>FPGA Bot</h2></div></a></article></div></div></aside><div id=cusdis_thread data-host=https://cusdis.com data-app-id=7418aefb-313d-4f79-b986-2dfbcb1be659 data-page-id=e80f6fa0037147a2ab1380d75e8206e6 data-page-url=https://churchmice.github.io/p/eda-server/ data-page-title="Building EDA server from scratch"></div><script async defer src=https://cusdis.com/js/cusdis.es.js></script><script>function setCusdisTheme(e){let t=document.querySelector("#cusdis_thread iframe");t&&window.CUSDIS.setTheme(e)}window.addEventListener("onColorSchemeChange",e=>{setCusdisTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 All Rights Reserved</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.27.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script><script async src="https://www.googletagmanager.com/gtag/js?id=G-KBJFX488RE"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-KBJFX488RE")</script></body></html>